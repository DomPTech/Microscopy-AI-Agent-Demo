<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Automated TEM App</title>

<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

<style>

* { box-sizing: border-box; font-family: Inter, system-ui, sans-serif; margin:0; padding:0; }
body { background:#f4f4f4; padding:20px; }

.top-toolbar {
  display:flex; align-items:center; gap:12px;
  background:white; padding:12px 16px;
  border-radius:14px; margin-bottom:14px;
}
.app-title { font-weight:700; font-size:20px; margin-right:auto; }
.tool-btn {
  width:44px; height:36px; background:#8ec6f0;
  border-radius:10px; display:grid; place-items:center;
  cursor:pointer;
}

.ai-status {
  display:flex; align-items:center; gap:8px;
}


.status-dot {
  width:10px; height:10px; border-radius:50%; background:#999;
}
.status-dot.running { background:#4caf50; }
.status-dot.error { background:#e53935; }
.status-text { font-size:14px; font-weight:600; }

.ai-toggle {
  display:flex; align-items:center; gap:8px; cursor:pointer; user-select:none;
}
.ai-toggle input { display:none; }


.ai-toggle .slider {
  width:40px; height:20px; background:#bbb;
  border-radius:20px; position:relative;
  transition: background 0.3s ease; flex-shrink:0;
  box-shadow: inset 0 0 2px rgba(0,0,0,0.2);
}

.ai-toggle .slider::before {
  content:""; width:18px; height:18px; background:#fff;
  border-radius:50%; position:absolute; top:1px; left:1px;
  transition: transform 0.3s ease, background 0.3s ease;
  box-shadow:0 1px 3px rgba(0,0,0,0.3);
}

.ai-toggle input:checked + .slider { background:#4caf50; }
.ai-toggle input:checked + .slider::before { transform:translateX(20px); }

.toggle-label { font-size:12px; font-weight:600; color:#333; user-select:none; }

.main-wrapper { background:#d9d9d9; border-radius:18px; padding:16px; }
.top-section { display:grid; grid-template-columns:1.3fr 1fr; gap:16px; margin-bottom:16px; }

.viewport {
  background:white; border-radius:16px; position:relative; overflow:hidden;
}
#threeContainer { width:100%; height:100%; min-height:360px; }

.screen { display:none; }
.screen.active { display:block; }

.sidebar {
  background:white; border-radius:16px; padding:16px;
  display:flex; flex-direction:column; gap:10px;
}
.action-btn { padding:10px; border-radius:10px; border:none; cursor:pointer; }
.action-btn.accent { background:#8ec6f0; }


.chatbot-area {
  background:white; border-radius:16px; padding:14px;
}
.chat-logs { height:120px; background:#f2f2f2; border-radius:10px; padding:8px; overflow-y:auto; margin-bottom:10px; }

</style>
</head>

<body>

<div class="top-toolbar">
  <div class="app-title">Automated TEM APP</div>

  <div class="tool-btn" data-screen="settings">üõ†Ô∏è</div>
  <div class="tool-btn" data-screen="ai">üéÆ</div>
  <div class="tool-btn" data-screen="analysis">üìä</div>
  <div class="tool-btn" data-screen="images">üì∏</div>
  <div class="tool-btn" data-screen="human">üî¨</div>
  <div class="tool-btn" data-screen="auto">ü§ñ</div>

  <div class="ai-status">
    <div id="statusDot" class="status-dot"></div>
    <div id="statusText" class="status-text">AI: IDLE</div>

    <!-- NEW TOGGLE SWITCH -->
    <label class="ai-toggle">
      <input type="checkbox" id="aiToggle">
      <div class="slider"></div>
      <span class="toggle-label">AI Mode</span>
    </label>
  </div>
</div>

<div class="main-wrapper">

<div class="top-section">

<div class="viewport">
  <div id="screen-live" class="screen active">
    <div id="threeContainer"></div>
  </div>

  <div id="screen-analysis" class="screen">
    <h3 style="padding:16px;">Analysis Screen (Graphs Here)</h3>
  </div>

  <div id="screen-images" class="screen">
    <h3 style="padding:16px;">Captured Images</h3>
  </div>

  <div id="screen-settings" class="screen">
    <h3 style="padding:16px;">Settings Panel</h3>
  </div>
</div>

<aside class="sidebar">
  <button class="action-btn" onclick="sendCmd('focus+')">FOCUS +</button>
  <button class="action-btn" onclick="sendCmd('focus-')">FOCUS -</button>
  <button class="action-btn accent" onclick="sendCmd('capture')">SNAP</button>
</aside>

</div>

<footer class="chatbot-area">
  <div id="chatLogs" class="chat-logs"></div>
  <input id="userInput" placeholder="Command..." />
  <button onclick="askAI()">EXECUTE</button>
</footer>

</div>

<script>
let aiEnabled = true;
const statusDot = document.getElementById("statusDot");
const statusText = document.getElementById("statusText");
const chatLogs = document.getElementById("chatLogs");

function switchScreen(name) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  const screen = document.getElementById("screen-" + name);
  if (screen) screen.classList.add("active");
}

document.querySelectorAll(".tool-btn").forEach(btn => {
  btn.onclick = () => {
    const screen = btn.dataset.screen;
    if (screen === "analysis") switchScreen("analysis");
    if (screen === "images") switchScreen("images");
    if (screen === "settings") switchScreen("settings");
    if (screen === "auto") switchScreen("live");
    if (screen === "human") switchScreen("live");
  };
});

function log(msg) {
  chatLogs.innerHTML += `<div>${msg}</div>`;
  chatLogs.scrollTop = chatLogs.scrollHeight;
}

document.getElementById("aiToggle").onchange = e => {
  aiEnabled = e.target.checked;
  statusDot.className = "status-dot" + (aiEnabled ? " running" : " error");
  statusText.textContent = aiEnabled ? "AI: IDLE" : "AI: DISABLED";
};

function sendCmd(cmd) {
  if (!aiEnabled) return log("Blocked by AI shutoff");
  log("CMD: " + cmd);
}

function askAI() {
  const input = document.getElementById("userInput");
  if (!input.value) return;
  log("USER: " + input.value);
  input.value = "";
}


let scene = new THREE.Scene();
let camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
camera.position.set(0,2,5);

let renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(600,400);
document.getElementById("threeContainer").appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,0.7));
let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,5);
scene.add(light);

let loader = new THREE.GLTFLoader();
loader.load(
  "models/WATCHTOWER1FORGAME.glb",
  gltf => {
    scene.add(gltf.scene);
    log("GLB loaded successfully");
  },
  undefined,
  err => log("GLB LOAD ERROR: " + err.message)
);

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();
</script>

</body>
</html>
